name: Generate Release Notes

on:
  schedule:
    - cron: '0 8 */15 * *' # Runs every 15 days at 08:00 UTC
  workflow_dispatch:
    inputs:
      source_repos:
        description: "Comma-separated repos (e.g. hotwax/fulfillment,hotwax/receiving,hotwax/inventory-count)"
        required: true
      release_tag:
        description: "Release tag (optional)"
        required: false

jobs:
  run-agent:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT_GITHUB }}
          fetch-depth: 0

      - name: Configure git user
        run: |
          git config --global user.email "release-bot@users.noreply.github.com"
          git config --global user.name "Release Notes Bot"

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: Install Node dependencies
        run: npm ci

      - name: Run release notes generator
        env:
          SOURCE_REPOS: ${{ inputs.source_repos }}
          RELEASE_TAG: ${{ inputs.release_tag }}
          GITHUB_TOKEN: ${{ secrets.PAT_GITHUB }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          TARGET_REPO: shubham-namdeo/UDM-Assignment
        run: node scripts/generate-release-notes.js
