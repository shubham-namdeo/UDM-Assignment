name: Generate Release Notes

on:
  workflow_dispatch:
    inputs:
      source_repo:
        description: "hotwax/receiving, hotwax/fulfillment, hotwax/inventory-count"
        required: true
      release_tag:
        description: "Release tag (optional)"
        required: false

jobs:
  run-agent:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Run release notes agent
        env:
          SOURCE_REPO: ${{ inputs.source_repo }}
          RELEASE_TAG: ${{ inputs.release_tag }}
          GITHUB_PERSONAL_ACCESS_TOKEN: ${{ secrets.GITHUB_PAT }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          npx antigravity@latest run release-notes-agent
