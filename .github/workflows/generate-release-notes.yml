name: Generate Release Notes

on:
  workflow_dispatch:
    inputs:
      source_repos:
        description: "hotwax/fulfillment,hotwax/receiving,hotwax/inventory-count"
        required: true
      release_tag:
        description: "Release tag (optional)"
        required: false

jobs:
  run-agent:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Configure git user
        run: |
          git config --global user.email "release-bot@users.noreply.github.com"
          git config --global user.name "Release Notes Bot"

      - name: Run release notes generator
        env:
          SOURCE_REPOS: ${{ inputs.source_repos }}
          RELEASE_TAG: ${{ inputs.release_tag }}
          GITHUB_TOKEN: ${{ secrets.PAT_GITHUB }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          node scripts/generate-release-notes.js
